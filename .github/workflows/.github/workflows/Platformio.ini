Firmware.bin






# ðŸŽ® **SD CARD BOOTABLE FIRMWARE - M5Stack Cardputer ADV** I'll create a system where you can: 1. **Put firmware.bin on SD card** â†’ Device auto-flashes it 2. **Store multiple firmware** â†’ Switch between them 3. **Backup current firmware** â†’ Restore if needed --- ## ðŸ“‚ **Complete SD Card Bootable Project** ``` ultimatum-cardputer-sd/ â”œâ”€â”€ src/ â”‚ â”œâ”€â”€ main.cpp # Main firmware â”‚ â”œâ”€â”€ sd_bootloader.cpp # SD card bootloader â”‚ â””â”€â”€ sd_bootloader.h â”œâ”€â”€ platformio.ini â”œâ”€â”€ data/ â”‚ â””â”€â”€ sd_structure.txt # Required SD card structure â””â”€â”€ README_SD_BOOT.md ``` --- ## ðŸ“„ **1. Updated `platformio.ini`** ```ini ; ================================================ ; ULTIMATUM SKELETON KEY - SD BOOTABLE ; M5Stack Cardputer ADV (ESP32-S3) ; ================================================ [env:m5cardputer_sd] platform = espressif32@6.4.0 board = m5stack-stamps3 framework = arduino ; ESP32-S3 Configuration board_build.mcu = esp32s3 board_build.f_cpu = 240000000L board_build.flash_mode = qio board_build.flash_size = 8MB board_build.partitions = default_8MB.csv board_build.filesystem = littlefs ; USB Configuration for Mobile Flashing build_flags = -DARDUINO_USB_MODE=1 -DARDUINO_USB_CDC_ON_BOOT=1 -DBOARD_HAS_PSRAM ; SD Card Boot Support -DSD_BOOT_ENABLED=1 -DSD_FIRMWARE_PATH="/ultimatum/firmware.bin" -DSD_CONFIG_PATH="/ultimatum/config" -DSD_APPS_PATH="/ultimatum/apps" ; M5Stack Cardputer ADV Specific -DM5CARDPUTER=1 -DFIRMWARE_VERSION=\"2.1-SD\" ; Display Configuration -DUSER_SETUP_LOADED=1 -DST7789_DRIVER=1 -DTFT_WIDTH=240 -DTFT_HEIGHT=135 -DTFT_ROTATION=1 -DTFT_MOSI=35 -DTFT_SCLK=36 -DTFT_CS=37 -DTFT_DC=34 -DTFT_RST=33 -DTFT_BL=38 ; SD Card Pins -DSD_CS=12 -DSD_MOSI=15 -DSD_MISO=39 -DSD_SCK=40 ; Upload Configuration upload_speed = 921600 monitor_speed = 115200 upload_protocol = esptool monitor_filters = esp32_exception_decoder ; Libraries lib_deps = m5stack/M5Unified@^0.1.11 m5stack/M5GFX@^0.1.11 crankyoldgit/IRremoteESP8266@^2.8.6 bblanchon/ArduinoJson@^7.0.2 https://github.com/espressif/arduino-esp32.git#2.0.14 ``` --- ## ðŸ“„ **2. `src/sd_bootloader.h`** ```cpp #ifndef SD_BOOTLOADER_H #define SD_BOOTLOADER_H #include <Arduino.h> #include <SD.h> #include <Update.h> #include <M5Cardputer.h> // SD Card Boot Configuration #define SD_MOUNT_POINT "/sd" #define FIRMWARE_DIR "/ultimatum" #define FIRMWARE_FILE "/ultimatum/firmware.bin" #define BACKUP_FILE "/ultimatum/firmware.bak" #define CONFIG_FILE "/ultimatum/config.json" #define APPS_DIR "/ultimatum/apps" // Boot modes enum BootMode { BOOT_NORMAL, // Boot normally BOOT_UPDATE, // Update from SD card BOOT_BACKUP, // Backup current firmware BOOT_RESTORE, // Restore from backup BOOT_LAUNCHER // Show app launcher }; class SDBootloader { public: SDBootloader(); bool init(); bool checkSDCard(); BootMode determineBootMode(); bool updateFirmwareFromSD(); bool backupCurrentFirmware(); bool restoreFromBackup(); void showBootScreen(String message, uint16_t color = TFT_WHITE); void showProgress(int percentage); bool listApps(); private: bool sdMounted; SPIClass* sdSPI; void playBootSound(); void playErrorSound(); void playSuccessSound(); }; #endif ``` --- ## ðŸ“„ **3. `src/sd_bootloader.cpp`** ```cpp #include "sd_bootloader.h" SDBootloader::SDBootloader() { sdMounted = false; sdSPI = nullptr; } bool SDBootloader::init() { M5Cardputer.Display.fillScreen(BLACK); M5Cardputer.Display.setTextColor(TFT_CYAN); M5Cardputer.Display.setTextSize(2); M5Cardputer.Display.setCursor(40, 20); M5Cardputer.Display.print("SD BOOTLOADER"); M5Cardputer.Display.setTextSize(1); M5Cardputer.Display.setTextColor(TFT_WHITE); M5Cardputer.Display.setCursor(10, 50); M5Cardputer.Display.print("Checking SD card..."); // Initialize SD card sdSPI = new SPIClass(FSPI); sdSPI->begin(SD_SCK, SD_MISO, SD_MOSI, SD_CS); if (!SD.begin(SD_CS, *sdSPI, 25000000)) { M5Cardputer.Display.setTextColor(TFT_RED); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("SD card not found!"); M5Cardputer.Display.setCursor(10, 85); M5Cardputer.Display.print("Booting normally..."); playErrorSound(); delay(2000); return false; } uint64_t cardSize = SD.cardSize() / (1024 * 1024); M5Cardputer.Display.setTextColor(TFT_GREEN); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.printf("SD card: %llu MB", cardSize); sdMounted = true; playBootSound(); delay(500); return true; } bool SDBootloader::checkSDCard() { return sdMounted && SD.cardType() != CARD_NONE; } BootMode SDBootloader::determineBootMode() { if (!checkSDCard()) { return BOOT_NORMAL; } M5Cardputer.Display.fillScreen(BLACK); M5Cardputer.Display.setTextSize(1); M5Cardputer.Display.setTextColor(TFT_YELLOW); M5Cardputer.Display.setCursor(10, 30); M5Cardputer.Display.print("SD CARD BOOT OPTIONS:"); M5Cardputer.Display.setTextColor(TFT_WHITE); M5Cardputer.Display.setCursor(10, 50); M5Cardputer.Display.print("Hold SPACE: Update firmware"); M5Cardputer.Display.setCursor(10, 65); M5Cardputer.Display.print("Hold B: Backup firmware"); M5Cardputer.Display.setCursor(10, 80); M5Cardputer.Display.print("Hold R: Restore backup"); M5Cardputer.Display.setCursor(10, 95); M5Cardputer.Display.print("Hold L: App Launcher"); M5Cardputer.Display.setTextColor(TFT_CYAN); M5Cardputer.Display.setCursor(10, 115); M5Cardputer.Display.print("Or wait 3 seconds..."); // Check for key press during countdown unsigned long startTime = millis(); bool spacePressed = false; bool bPressed = false; bool rPressed = false; bool lPressed = false; while (millis() - startTime < 3000) { M5Cardputer.update(); if (M5Cardputer.Keyboard.isChange() && M5Cardputer.Keyboard.isPressed()) { Keyboard_Class::KeysState status = M5Cardputer.Keyboard.keysState(); for (auto key : status.word) { if (key == ' ') spacePressed = true; if (key == 'b' || key == 'B') bPressed = true; if (key == 'r' || key == 'R') rPressed = true; if (key == 'l' || key == 'L') lPressed = true; } } // Show countdown int remaining = 3 - ((millis() - startTime) / 1000); M5Cardputer.Display.fillRect(180, 115, 50, 12, BLACK); M5Cardputer.Display.setCursor(180, 115); M5Cardputer.Display.printf("[%d]", remaining); delay(100); } if (spacePressed) { return BOOT_UPDATE; } else if (bPressed) { return BOOT_BACKUP; } else if (rPressed) { return BOOT_RESTORE; } else if (lPressed) { return BOOT_LAUNCHER; } // Check if firmware file exists for auto-update if (SD.exists(FIRMWARE_FILE)) { M5Cardputer.Display.fillScreen(BLACK); M5Cardputer.Display.setTextColor(TFT_YELLOW); M5Cardputer.Display.setCursor(10, 50); M5Cardputer.Display.print("Firmware found on SD!"); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("Auto-updating..."); delay(1000); return BOOT_UPDATE; } return BOOT_NORMAL; } bool SDBootloader::updateFirmwareFromSD() { showBootScreen("FIRMWARE UPDATE", TFT_YELLOW); File firmwareFile = SD.open(FIRMWARE_FILE); if (!firmwareFile) { showBootScreen("Error: firmware.bin not found!", TFT_RED); playErrorSound(); delay(3000); return false; } size_t fileSize = firmwareFile.size(); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.setTextColor(TFT_WHITE); M5Cardputer.Display.printf("Size: %d KB", fileSize / 1024); if (fileSize == 0 || fileSize > 0x400000) { // Max 4MB showBootScreen("Error: Invalid firmware size!", TFT_RED); firmwareFile.close(); playErrorSound(); delay(3000); return false; } // Begin update if (!Update.begin(fileSize)) { showBootScreen("Error: Not enough space!", TFT_RED); firmwareFile.close(); playErrorSound(); delay(3000); return false; } M5Cardputer.Display.setCursor(10, 90); M5Cardputer.Display.print("Flashing..."); // Flash firmware with progress uint8_t buffer[4096]; size_t written = 0; int lastProgress = 0; while (firmwareFile.available()) { size_t toRead = min((size_t)firmwareFile.available(), sizeof(buffer)); firmwareFile.read(buffer, toRead); if (Update.write(buffer, toRead) != toRead) { showBootScreen("Error: Write failed!", TFT_RED); Update.printError(Serial); firmwareFile.close(); playErrorSound(); delay(3000); return false; } written += toRead; int progress = (written * 100) / fileSize; if (progress != lastProgress && progress % 5 == 0) { showProgress(progress); lastProgress = progress; } } firmwareFile.close(); if (Update.end(true)) { showBootScreen("Update successful!", TFT_GREEN); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("Deleting firmware.bin..."); // Delete firmware file after successful flash SD.remove(FIRMWARE_FILE); M5Cardputer.Display.setCursor(10, 90); M5Cardputer.Display.print("Rebooting in 3s..."); playSuccessSound(); delay(3000); ESP.restart(); return true; } else { showBootScreen("Error: Update failed!", TFT_RED); Update.printError(Serial); playErrorSound(); delay(3000); return false; } } bool SDBootloader::backupCurrentFirmware() { showBootScreen("BACKUP FIRMWARE", TFT_CYAN); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("Creating backup..."); // Create directory if not exists if (!SD.exists(FIRMWARE_DIR)) { SD.mkdir(FIRMWARE_DIR); } File backupFile = SD.open(BACKUP_FILE, FILE_WRITE); if (!backupFile) { showBootScreen("Error: Cannot create backup!", TFT_RED); playErrorSound(); delay(3000); return false; } // Read current firmware from flash const esp_partition_t* running = esp_ota_get_running_partition(); if (!running) { showBootScreen("Error: Cannot read partition!", TFT_RED); backupFile.close(); playErrorSound(); delay(3000); return false; } size_t partitionSize = running->size; uint8_t buffer[4096]; size_t written = 0; int lastProgress = 0; for (size_t offset = 0; offset < partitionSize; offset += sizeof(buffer)) { size_t toRead = min(sizeof(buffer), partitionSize - offset); if (esp_partition_read(running, offset, buffer, toRead) != ESP_OK) { showBootScreen("Error: Read failed!", TFT_RED); backupFile.close(); playErrorSound(); delay(3000); return false; } backupFile.write(buffer, toRead); written += toRead; int progress = (written * 100) / partitionSize; if (progress != lastProgress && progress % 5 == 0) { showProgress(progress); lastProgress = progress; } } backupFile.close(); showBootScreen("Backup complete!", TFT_GREEN); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.printf("Saved: %d KB", written / 1024); playSuccessSound(); delay(3000); return true; } bool SDBootloader::restoreFromBackup() { showBootScreen("RESTORE BACKUP", TFT_MAGENTA); if (!SD.exists(BACKUP_FILE)) { showBootScreen("Error: No backup found!", TFT_RED); playErrorSound(); delay(3000); return false; } File backupFile = SD.open(BACKUP_FILE); if (!backupFile) { showBootScreen("Error: Cannot open backup!", TFT_RED); playErrorSound(); delay(3000); return false; } size_t fileSize = backupFile.size(); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.printf("Size: %d KB", fileSize / 1024); if (!Update.begin(fileSize)) { showBootScreen("Error: Update init failed!", TFT_RED); backupFile.close(); playErrorSound(); delay(3000); return false; } M5Cardputer.Display.setCursor(10, 90); M5Cardputer.Display.print("Restoring..."); uint8_t buffer[4096]; size_t written = 0; int lastProgress = 0; while (backupFile.available()) { size_t toRead = min((size_t)backupFile.available(), sizeof(buffer)); backupFile.read(buffer, toRead); if (Update.write(buffer, toRead) != toRead) { showBootScreen("Error: Write failed!", TFT_RED); backupFile.close(); playErrorSound(); delay(3000); return false; } written += toRead; int progress = (written * 100) / fileSize; if (progress != lastProgress && progress % 5 == 0) { showProgress(progress); lastProgress = progress; } } backupFile.close(); if (Update.end(true)) { showBootScreen("Restore successful!", TFT_GREEN); M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("Rebooting in 3s..."); playSuccessSound(); delay(3000); ESP.restart(); return true; } else { showBootScreen("Error: Restore failed!", TFT_RED); playErrorSound(); delay(3000); return false; } } bool SDBootloader::listApps() { showBootScreen("APP LAUNCHER", TFT_CYAN); if (!SD.exists(APPS_DIR)) { M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("No apps found"); M5Cardputer.Display.setCursor(10, 85); M5Cardputer.Display.print("Create /ultimatum/apps/"); delay(3000); return false; } File appsDir = SD.open(APPS_DIR); if (!appsDir || !appsDir.isDirectory()) { M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("Error opening apps dir"); delay(3000); return false; } std::vector<String> appList; File file = appsDir.openNextFile(); while (file) { if (!file.isDirectory() && String(file.name()).endsWith(".bin")) { appList.push_back(String(file.name())); } file = appsDir.openNextFile(); } if (appList.empty()) { M5Cardputer.Display.setCursor(10, 70); M5Cardputer.Display.print("No .bin files found"); delay(3000); return false; } // Display app list M5Cardputer.Display.fillScreen(BLACK); M5Cardputer.Display.setTextSize(1); M5Cardputer.Display.setTextColor(TFT_YELLOW); M5Cardputer.Display.setCursor(10, 10); M5Cardputer.Display.print("AVAILABLE APPS:"); int y = 30; for (size_t i = 0; i < appList.size() && i < 8; i++) { M5Cardputer.Display.setTextColor(TFT_WHITE); M5Cardputer.Display.setCursor(10, y); M5Cardputer.Display.printf("%d. %s", i + 1, appList[i].c_str()); y += 12; } M5Cardputer.Display.setTextColor(TFT_CYAN); M5Cardputer.Display.setCursor(10, 120); M5Cardputer.Display.print("Press 1-8 to load app"); // Wait for selection unsigned long startTime = millis(); while (millis() - startTime < 10000) { M5Cardputer.update(); if (M5Cardputer.Keyboard.isChange() && M5Cardputer.Keyboard.isPressed()) { Keyboard_Class::KeysState status = M5Cardputer.Keyboard.keysState(); for (auto key : status.word) { if (key >= '1' && key <= '8') { int index = key - '1'; if (index < appList.size()) { // Copy selected app to firmware.bin String appPath = String(APPS_DIR) + "/" + appList[index]; File srcFile = SD.open(appPath); File dstFile = SD.open(FIRMWARE_FILE, FILE_WRITE); if (srcFile && dstFile) { uint8_t buffer[4096]; while (srcFile.available()) { size_t toRead = min((size_t)srcFile.available(), sizeof(buffer)); srcFile.read(buffer, toRead); dstFile.write(buffer, toRead); } srcFile.close(); dstFile.close(); // Trigger update return updateFirmwareFromSD(); } } } } } delay(100); } return false; } void SDBootloader::showBootScreen(String message, uint16_t color) { M5Cardputer.Display.fillScreen(BLACK); M5Cardputer.Display.setTextSize(2); M5Cardputer.Display.setTextColor(color); M5Cardputer.Display.setCursor(10, 50); M5Cardputer.Display.print(message); } void SDBootloader::showProgress(int percentage) { // Progress bar int barWidth = 200; int barHeight = 20; int barX = 20; int barY = 100; M5Cardputer.Display.drawRect(barX, barY, barWidth, barHeight, TFT_WHITE); M5Cardputer.Display.fillRect(barX + 2, barY + 2, (barWidth - 4) * percentage / 100, barHeight - 4, TFT_GREEN); M5Cardputer.Display.fillRect(80, barY + 25, 80, 12, BLACK); M5Cardputer.Display.setCursor(90, barY + 25); M5Cardputer.Display.setTextSize(1); M5Cardputer.Display.setTextColor(TFT_WHITE); M5Cardputer.Display.printf("%d%%", percentage); } void SDBootloader::playBootSound() { M5Cardputer.Speaker.tone(1000, 100); delay(100); M5Cardputer.Speaker.tone(1500, 100); } void SDBootloader::playErrorSound() { M5Cardputer.Speaker.tone(500, 200); delay(200); M5Cardputer.Speaker.tone(300, 200); } void SDBootloader::playSuccessSound() { M5Cardputer.Speaker.tone(1000, 100); delay(100); M5Cardputer.Speaker.tone(1500, 100); delay(100); M5Cardputer.Speaker.tone(2000, 200); } ``` --- ## ðŸ“„ **4. Updated `src/main.cpp`** (with SD bootloader integration) Add at the beginning of `setup()`: ```cpp #include "sd_bootloader.h" // ... (rest of includes) // Add global bootloader instance SDBootloader bootloader; void setup() { // Initialize M5Cardputer first auto cfg = M5.config(); M5Cardputer.begin(cfg); M5Cardputer.Display.setRotation(1); Serial.begin(115200); Serial.println("\n================================"); Serial.println("ULTIMATUM SD BOOTLOADER"); Serial.println("================================\n"); // Initialize SD bootloader if (bootloader.init()) { BootMode mode = bootloader.determineBootMode(); switch (mode) { case BOOT_UPDATE: bootloader.updateFirmwareFromSD(); break; case BOOT_BACKUP: bootloader.backupCurrentFirmware(); break; case BOOT_RESTORE: bootloader.restoreFromBackup(); break; case BOOT_LAUNCHER: bootloader.listApps(); break; case BOOT_NORMAL: default: // Continue with normal boot break; } } // ... (rest of original setup code) ``` --- ## ðŸ“„ **5. `data/sd_structure.txt`** (SD Card Folder Structure) ``` SD CARD STRUCTURE ================= /ultimatum/ â”œâ”€â”€ firmware.bin # Put new firmware here (auto-flashes on boot) â”œâ”€â”€ firmware.bak # Backup of current firmware (created by 'B' key) â”œâ”€â”€ config.json # Configuration file â”œâ”€â”€ ir_codes.json # Saved IR codes â”œâ”€â”€ rfid_cards.json # Saved RFID cards â””â”€â”€ apps/ â”œâ”€â”€ ir_blaster.bin # Individual app modules â”œâ”€â”€ wifi_scanner.bin â””â”€â”€ bt_scanner.bin HOW TO USE: =========== METHOD 1: Auto-Update (Easiest) --------------------------------- 1. Copy firmware.bin to /ultimatum/ folder on SD card 2. Insert SD card into Cardputer 3. Power on device 4. Firmware will auto-flash and reboot 5. firmware.bin will be deleted after successful update METHOD 2: Manual Boot Options ------------------------------ 1. Insert SD card 2. Power on device 3. During 3-second countdown: - Press SPACE: Update firmware - Press B: Backup current firmware - Press R: Restore from backup - Press L: App launcher - Wait: Boot normally METHOD 3: App Launcher ---------------------- 1. Put multiple .bin files in /ultimatum/apps/ 2. Press 'L' during boot 3. Select app to load 4. Device will flash selected app and reboot ``` --- ## ðŸ“„ **6. `README_SD_BOOT.md`** ```markdown # ðŸŽ® SD Card Bootable Firmware for M5Stack Cardputer ADV ## ðŸ“¦ Features âœ… **Auto-Update** - Drop firmware.bin on SD card, device auto-flashes âœ… **Backup/Restore** - Save current firmware to SD card âœ… **App Launcher** - Switch between multiple firmware apps âœ… **No Computer Required** - Update from phone/tablet âœ… **Safe Recovery** - Restore backup if update fails --- ## ðŸš€ Quick Start ### First Time Setup: 1. **Compile firmware:** ```bash pio run ``` 2. **Flash initial firmware via USB:** ```bash pio run --target upload ``` 3. **Prepare SD card:** - Format as FAT32 - Create folder: `/ultimatum/` - Create folder: `/ultimatum/apps/` 4. **Done!** Device now supports SD boot --- ## ðŸ“± Update from Phone/Tablet (No Computer) 1. **Download firmware.bin to phone** 2. **Connect phone to SD card:** - Use USB-C card reader OR - Remove SD from Cardputer, insert in phone 3. **Copy firmware.bin to `/ultimatum/` on SD** 4. **Insert SD into Cardputer** 5. **Power on** â†’ Auto-updates! --- ## ðŸŽ® Boot Options When device powers on with SD card inserted: | Key | Action | |-----|--------| | **SPACE** | Force firmware update | | **B** | Backup current firmware to SD | | **R** | Restore firmware from backup | | **L** | Show app launcher | | **Wait 3s** | Auto-update if firmware.bin exists, else boot normally | --- ## ðŸ“‚ SD Card Structure ``` SD:/ â””â”€â”€ ultimatum/ â”œâ”€â”€ firmware.bin # Main firmware (auto-deleted after flash) â”œâ”€â”€ firmware.bak # Backup (created with 'B' key) â”œâ”€â”€ config.json # Settings â”œâ”€â”€ ir_codes.json # Saved IR codes â””â”€â”€ apps/ â”œâ”€â”€ ir_tool.bin â”œâ”€â”€ wifi_tool.bin â””â”€â”€ bt_scanner.bin ``` --- ## ðŸ”§ Compile Firmware for SD Card ```bash # Compile pio run # Find firmware at: # .pio/build/m5cardputer_sd/firmware.bin # Copy to SD card cp .pio/build/m5cardputer_sd/firmware.bin /path/to/sd/ultimatum/ ``` --- ## ðŸ“± Create Firmware Package for Distribution ```bash # Build release firmware pio run --environment m5cardputer_sd # Create distribution package mkdir -p release/ultimatum cp .pio/build/m5cardputer_sd/firmware.bin release/ultimatum/ cp data/sd_structure.txt release/ # Zip for distribution zip -r Ultimatum_v2.1_SD.zip release/ # Users just extract to SD card root! ``` --- ## âš ï¸ Troubleshooting | Issue | Solution | |-------|----------| | SD card not detected | Check if formatted as FAT32 | | Update fails | Try restoring backup with 'R' key | | Boot loop | Remove SD card, device boots from flash | | Backup too large | SD card must have 4MB+ free space | | firmware.bin not found | Check file is in `/ultimatum/` folder | --- ## ðŸ”’ Safety Features âœ… **Automatic verification** - Update only proceeds if firmware valid âœ… **Backup before update** - Press 'B' to save current firmware âœ… **Auto-delete after flash** - firmware.bin removed to prevent re-flash âœ… **Failsafe boot** - Remove SD card to boot from internal flash --- ## ðŸ“¦ Distribution Example Share firmware as a single ZIP file: ``` Ultimatum_v2.1_SD.zip â”œâ”€â”€ README.txt â”œâ”€â”€ HOW_TO_INSTALL.txt â””â”€â”€ ultimatum/ â””â”€â”€ firmware.bin ``` Users extract to SD card root and power on! --- ## ðŸ’¡ Advanced: Multiple Firmwares Store different tools in `/ultimatum/apps/`: ```bash # App 1: IR Blaster only apps/ir_blaster.bin # App 2: WiFi Tools only apps/wifi_tools.bin # App 3: Full featured apps/ultimatum_full.bin ``` Press 'L' at boot to choose which app to load! --- ## ðŸ› ï¸ Build Different Apps ```ini ; platformio.ini [env:app_ir] build_flags = -DAPP_IR_ONLY [env:app_wifi] build_flags = -DAPP_WIFI_ONLY [env:app_full] build_flags = -DAPP_FULL_FEATURED ``` ```bash # Build different variants pio run -e app_ir pio run -e app_wifi pio run -e app_full # Copy to SD apps folder cp .pio/build/app_ir/firmware.bin /sd/ultimatum/apps/ir_blaster.bin cp .pio/build/app_wifi/firmware.bin /sd/ultimatum/apps/wifi_tools.bin ``` --- ## ðŸ“± Mobile Workflow 1. **Download firmware on phone** 2. **Connect SD card to phone** (USB-C reader or adapter) 3. **Copy firmware.bin** to `/ultimatum/` 4. **Eject SD safely** 5. **Insert SD in Cardputer** 6. **Power on** â†’ Done! No computer needed! ðŸŽ‰ ``` --- ## ðŸš€ **Complete Build & Deploy Script** Create `build_sd_release.sh`: ```bash #!/bin/bash echo "================================" echo "Building Ultimatum SD Release" echo "================================" # Clean previous build pio run --target clean # Build firmware pio run # Create release structure mkdir -p release/ultimatum mkdir -p release/ultimatum/apps mkdir -p release/ultimatum/config # Copy firmware cp .pio/build/m5cardputer_sd/firmware.bin release/ultimatum/ # Create readme cat > release/README.txt << EOF ULTIMATUM SKELETON KEY v2.1 - SD BOOTABLE ========================================== QUICK START: 1. Copy the 'ultimatum' folder to the root of your SD card 2. Insert SD card into M5Stack Cardputer ADV 3. Power on device 4. Firmware will auto-install! STRUCTURE: SD:/ â””â”€â”€ ultimatum/ â””â”€â”€ firmware.bin <- Will auto-flash and delete After installation, you can update anytime by: - Copying new firmware.bin to /ultimatum/ - Powering on the device For more info: https://github.com/yourusername/ultimatum EOF # Create ZIP cd release zip -r ../Ultimatum_v2.1_SD_Release.zip * cd .. echo "" echo "âœ… Release package created: Ultimatum_v2.1_SD_Release.zip" echo "ðŸ“¦ Users can extract this to SD card root and power on!" ``` Make executable and run: ```bash chmod +x build_sd_release.sh ./build_sd_release.sh ``` --- ## âœ… **What You Get** 1. âœ… **Drop firmware.bin on SD** â†’ Auto-flashes on boot 2. âœ… **Backup/Restore functionality** â†’ Press B/R during boot 3. âœ… **App launcher** â†’ Switch between multiple firmware 4. âœ… **No computer needed** â†’ Update from phone 5. âœ… **Distribution ready** â†’ Share as single ZIP file 6. âœ… **Failsafe** â†’ Remove SD to boot from internal flash Now you can **update your Cardputer just by copying a file to SD card**! ðŸŽ‰
